from sim.circuits_obj import *
from sim.SEC import *
from sim.PTM import *
import sim.bitstreams as bs
import matplotlib.pyplot as plt

#Helper function - exhaustive input combinations for constant inputs
def consts_iter(prec): #really shouldn't run this with prec > 5
    lim = 2 ** prec
    inc = 2 ** (-prec)
    v1, v2, v3, v4 = inc, inc, inc, inc
    for _ in range(lim-1):
        for _ in range(lim-1):
            for _ in range(lim-1):
                for _ in range(lim-1):
                    yield [v1, v2, v3, v4]
                    v4 += inc
                v4 = inc
                v3 += inc
            v3 = inc
            v2 += inc
        v2 = inc
        v1 += inc

def ptv_gen(Px):
    return np.kron(get_vin_mc0(Px[4:]), get_vin_mc1(Px[:4]))

def test_perturb_ptm():
    samps = 100
    max_precision = 2
    num_perturbs = 64
    sccs_correct = []
    sccs_perturbed = []
    errs = []
    for consts in consts_iter(max_precision):
        print(consts)
        cir = PARALLEL_MAC_2(consts, max_precision, bipolar=False)
        actual_precision = cir.actual_precision
        ptm = cir.ptm()
        err1 = 0.0
        err2 = 0.0
        #perturb the ptm
        #randomly shift one row to the "11" output state (randomly add more output correlation)
        n, k = ptm.shape
        perturbed_ptm = np.array(ptm)
        rows = []
        for _ in range(num_perturbs):
            row = np.random.randint(n)
            while row in rows:
                row = np.random.randint(n)
            rows.append(row)
            cout_correct = 0.0
            cout_perturbed = 0.0
            perturbed_ptm[row, :] = np.array([False, False, False, True], dtype=np.bool_)
        for samp in range(samps):
            x_vals = np.random.uniform(size=4)
            correct = np.array([
                0.5*(x_vals[0]*consts[0] + x_vals[1]*consts[1]),
                0.5*(x_vals[2]*consts[2] + x_vals[3]*consts[3])
            ])
            px = np.concatenate((x_vals, np.array([0.5 for _ in range(actual_precision + 1)])))
            ptv = ptv_gen(px)
            vout_correct = ptm.T @ ptv
            vout_perturbed = perturbed_ptm.T @ ptv
            correct_pz = B_mat(2).T @ vout_correct
            perturbed_pz = B_mat(2).T @ vout_perturbed
            assert np.allclose(correct, correct_pz)

            cout_correct += get_corr_mat_paper(vout_correct)[0, 1]
            cout_perturbed += get_corr_mat_paper(vout_perturbed)[0, 1]
            err1 += np.abs(correct_pz - perturbed_pz)[0]
            err2 += np.abs(correct_pz - perturbed_pz)[1]
        sccs_correct.append(cout_correct / samps)
        sccs_perturbed.append(cout_perturbed / samps)
        errs.append((err1 + err2) / (2*samps))
    
    print(sccs_perturbed)
    print(errs)

    #Results from prior runs (copy pasted here to save compute time)
    opt = [0.9660014884700585, 0.890489968191904, 0.8498033374126837, 0.8879005869890056, 0.8828102866986289, 0.8417805357344568, 0.8425587669185268, 0.8512580518513033, 0.8230719951419736, 0.8847159776514519, 0.9422325950148813, 0.8779231103037204, 0.9446623244399621, 0.8866977713186837, 0.853625237487055, 0.8742290755561651, 0.8472057617966855, 0.864713261854225, 0.8387398735523707, 0.8752280033880074, 0.9396716219634407, 0.8810210446891764, 0.9309087470330177, 0.8680412985735477, 0.9315160334883364, 0.8806708626211083, 0.846833888237907, 0.8878305927932176, 0.949875244953841, 0.8761823214356268, 0.9406083085141731, 0.8825924336783968, 0.859643824661309, 0.8721786038401462, 0.853897155096481, 0.8657448147059382, 0.8878019415742493, 0.892047203711209, 0.9290506543951781, 0.883583274097489, 0.9528501548549592, 0.8870678443215858, 0.9298017638072814, 0.8732896026551523, 0.8416934525245477, 0.854478214201224, 0.8452297362717709, 0.8780691763542353, 0.8498602316427091, 0.8764347966316263, 0.9289174827073015, 0.8734021091980121, 0.9320306776397386, 0.8605537119840049, 0.8432124219970993, 0.8646300881555834, 0.9384742447812041, 0.87084787742022, 0.9194182345250391, 0.8569191600623345, 0.9422831882744325, 0.8657400443113812, 0.8569595099393849, 0.851451280356312, 0.8708296209743067, 0.8744861644277788, 0.8590471556404192, 0.8834984357001544, 0.9430872140155844, 0.8760517890722641, 0.9310638906675022, 0.8618976184800052, 0.8187287953362589, 0.8634622905131758, 0.8501437558051644, 0.8560543154048604, 0.8308465746849485, 0.8702244243571231, 0.8528554843330581, 0.8631319143716997, 0.9402576416312266]
    sccs_perturbed_1 = [0.8603891496071668, 0.7174602072953944, 0.6813585958389331, 0.7131862932537548, 0.7416410073553162, 0.6047362844479197, 0.6734944108769783, 0.6192761042673843, 0.6517650033840654, 0.7375435336296945, 0.8456127164835386, 0.7681662166095308, 0.46903214344102795, 0.6851125148815627, 0.6727585648222171, 0.38044979683462443, 0.6229446702406103, 0.5743989068314106, 0.7301424133576675, 0.7675384495122141, 0.847878968406439, 0.3616441128368431, 0.5212104199151595, 0.714092182500687, 0.25793587546674024, 0.4150589273284753, 0.6599338171318107, 0.7052374430836288, 0.4726456624302689, 0.39863167710105224, 0.8506714532365213, 0.7801564318180594, 0.730762746730815, 0.7613051988032105, 0.6707022466239286, 0.6256003589325307, 0.629028242195981, 0.7369762236459095, 0.5406713380704926, 0.7490941535079042, 0.8196033288908805, 0.7186544723010219, 0.46104942041174923, 0.6409988826937131, 0.6208235757763173, 0.6250189123486324, 0.6938768779766058, 0.7446886771590112, 0.7283278092404069, 0.73107908912494, 0.8299487955507142, 0.41886326243370176, 0.5540790610424984, 0.6667689293728138, 0.6217259787810481, 0.46906015820135133, 0.23009949043804057, 0.7239853974337401, 0.5395181338833287, 0.3935965947314065, 0.8711587505124229, 0.6765616720822087, 0.643443729108101, 0.652068943050736, 0.6856137066261933, 0.40172233825305603, 0.6791976261534092, 0.7016595110692063, 0.5549867402718214, 0.676307483627767, 0.8572595464280732, 0.6982457730684931, 0.6062817908425588, 0.5169032108713529, 0.6458481243439929, 0.581686610889224, 0.5737912713902438, 0.7351866898007522, 0.6125142761225526, 0.6656301533941762, 0.757450892139792]
    sccs_perturbed_2 = [0.8757019798678786, 0.792833125863502, 0.66567281287643, 0.7716972055163807, 0.7260839676186996, 0.650988646544471, 0.7641188222710162, 0.6938612441230725, 0.5706918027308219, 0.7139195161170232, 0.8617551544453597, 0.7499395178272773, 0.5479760921618022, 0.736839709727781, 0.6559359501123335, 0.45702339240029055, 0.636023045882547, 0.6069916053496356, 0.7378008161086924, 0.6763774988742608, 0.8471745203013407, 0.45769790154198126, 0.5630919348281748, 0.7171876565787335, 0.23814254567925885, 0.47191257637996437, 0.6557919254816005, 0.7899565212217958, 0.49786871375229663, 0.3820903762711282, 0.8631571397868332, 0.7604077061526732, 0.7035435755477573, 0.6815508282877328, 0.6982767254236611, 0.6788624336173258, 0.7537225001036412, 0.7157076900038166, 0.5153409530971291, 0.8117276858996414, 0.8129601474526282, 0.6749857050271741, 0.5384295289798523, 0.7196848132044248, 0.6080668455644639, 0.6082523071852662, 0.6593958206268702, 0.6919837769471033, 0.6618327934977583, 0.7224195533518913, 0.79151747071337, 0.44442956099435194, 0.5485530421430791, 0.7420294040311199, 0.6883146764974374, 0.39318919048875145, 0.27559311016538146, 0.7317452608545411, 0.5544317289307956, 0.42506664476593414, 0.8713236271749687, 0.7192153565796379, 0.6960057368417292, 0.5726179334312821, 0.7002952283265447, 0.42599351507890504, 0.6857252811663301, 0.7485614035184437, 0.5373013392367412, 0.6871753988075282, 0.8247543000917958, 0.7034366978923675, 0.5738378404435985, 0.6393951551903968, 0.6483048436817537, 0.624003184036501, 0.6216079682181127, 0.6638944387143496, 0.6133920509945768, 0.6678632337929542, 0.785375033800824]
    sccs_perturbed_4 = [0.9355565584056496, 0.7847676041154952, 0.7763084746402601, 0.8091475963235379, 0.7544620157110924, 0.6758036291992388, 0.7125669499369667, 0.714323544058321, 0.6292652820132248, 0.7437069956278686, 0.9146388735778251, 0.7495003794101436, 0.4931467716416702, 0.7561999001084323, 0.6679792057834306, 0.4554778874665192, 0.7152018736892578, 0.6183399175164728, 0.6613129677914358, 0.7719004431049494, 0.8819466817431141, 0.47903774598298715, 0.6557922556274361, 0.8021157210561654, 0.31058090374258923, 0.41988551927601525, 0.6735815152675364, 0.7905258132281453, 0.5782923680851756, 0.43845887236376874, 0.8954145756860175, 0.7503481681499607, 0.738483170700576, 0.7429500547604941, 0.7278210749906657, 0.6976603696916241, 0.7190681049786857, 0.7408565081106473, 0.5709110925278307, 0.813851591151995, 0.8459736008540752, 0.7349975774717307, 0.5890351236557145, 0.7512680632449367, 0.6945744689211593, 0.7201741170477395, 0.7086921380665088, 0.733252773580132, 0.6630378724181695, 0.6977968248403993, 0.8553775741111128, 0.5047923823135138, 0.5245738817047408, 0.6979359150612053, 0.6503146157987768, 0.5158030804281277, 0.3444848478979769, 0.7851563275713787, 0.5432448916491214, 0.5373914455509801, 0.8962420057881902, 0.7264393738174629, 0.726433617710223, 0.6093254222643462, 0.677325256267943, 0.46672893448819464, 0.6751454327109352, 0.6999318337873645, 0.5201527165934944, 0.7168094165118909, 0.8569282278456043, 0.7069612557956966, 0.7136315337981339, 0.6078015606351679, 0.68479159849665, 0.6743328822686074, 0.6216803821172705, 0.6418499264422073, 0.6563108815692387, 0.7516734928387956, 0.8057001397038168]
    sccs_perturbed_8 = [0.8955687498846455, 0.7559048474965084, 0.8108140170112347, 0.7928403587199881, 0.7446394981584897, 0.7568490292497684, 0.7688452352296987, 0.7061258935008847, 0.7465369198342096, 0.7663515447531296, 0.9111833570560596, 0.7910425261594847, 0.6152804496210019, 0.752233545361421, 0.697457034409778, 0.6064961004972501, 0.7754259433724041, 0.6931312594082608, 0.7836614743661237, 0.7683714851719763, 0.9267067709932852, 0.5576765140880465, 0.6749980401120352, 0.7843226902009924, 0.3399365859962253, 0.4873592399273058, 0.6820898825076678, 0.7934282880645371, 0.6283015076689167, 0.569409275011638, 0.8918753447309671, 0.7764604855574158, 0.7356001820160443, 0.7923728244571089, 0.6797645259223526, 0.6581553665528134, 0.7557975292276038, 0.7757195041757287, 0.6187215788421109, 0.8016433267732407, 0.9388717755979121, 0.7433664735561352, 0.6434968570777913, 0.7397537100213882, 0.6948269207515323, 0.7327141244240005, 0.7369335625776308, 0.7360670331496344, 0.7454226402446573, 0.7245825551991409, 0.8430521601680289, 0.4742563720355985, 0.5487496839874364, 0.7407131262444193, 0.7899196498757611, 0.5209398869028563, 0.5429098818809623, 0.7745328385620038, 0.6240213013465385, 0.42502568709387106, 0.8866331128599217, 0.7783206575236136, 0.6523546658202978, 0.7209369643906172, 0.7843805167497065, 0.5085422219552809, 0.7887921826685258, 0.8153250714182673, 0.6293919968040016, 0.8248300191150031, 0.8128609480257903, 0.7115213899256335, 0.6732087834044481, 0.6787638906741641, 0.7551868712997571, 0.6825163388672513, 0.644503815369612, 0.6683467477501007, 0.6288074495992297, 0.6921064964963572, 0.8196401787311375]
    sccs_perturbed_16 = [0.9185130806372137, 0.8635436699173387, 0.8870202821818468, 0.8917752250455412, 0.8250294276951005, 0.8091127750227356, 0.8385207495165856, 0.8556021176628116, 0.7946417060491965, 0.9033422503576601, 0.9176265727181045, 0.8933925825301579, 0.6164948577832974, 0.7735440360074755, 0.7803114056521706, 0.6214580361564859, 0.7975894400567869, 0.7464647094219573, 0.7477206488096746, 0.9000509855395096, 0.9299012151844974, 0.6034270919048164, 0.6635789292395361, 0.8562552362076725, 0.4764355922026928, 0.5807184578928843, 0.7869972704025394, 0.8167990837994953, 0.734215323240676, 0.622102492961159, 0.9230366608019155, 0.8331334258319049, 0.7855630851293165, 0.8111203855613297, 0.7669087654384239, 0.7988561359743243, 0.8116765027366216, 0.8429660426035707, 0.7195801756907977, 0.853338502945853, 0.9466873835260615, 0.7587662269856073, 0.7553143398622361, 0.7750496748950851, 0.7219807330600063, 0.8617089874001519, 0.7683775076349469, 0.8070185921601464, 0.7378946904034044, 0.8347244693920899, 0.8840148234541613, 0.5476586286388562, 0.6692536023924043, 0.7025273113486056, 0.8595040814849912, 0.647605726248024, 0.6369730121954985, 0.8303226782233553, 0.7041003730308354, 0.6353944521222675, 0.926742612005209, 0.8279395616049625, 0.7681368584678423, 0.7799496573258423, 0.7777531977566882, 0.5849968563473398, 0.7097506817385778, 0.7787741817251665, 0.6514295576017161, 0.8114693097335252, 0.8617972061603513, 0.7310219607540414, 0.7975474321188456, 0.7402991768822056, 0.7801563308122266, 0.7288179687508475, 0.7014103058238106, 0.8257335795417816, 0.8114241678430214, 0.7441821724886372, 0.8601729009065727]
    sccs_perturbed_32 = [0.9570790314023334, 0.9209666369425095, 0.8935085752260358, 0.864639514446242, 0.8605968987831649, 0.8375822574667906, 0.9283526078079727, 0.8994170473519251, 0.8189991096140916, 0.9031783418794272, 0.9647745701808814, 0.9169242664854312, 0.717368348960353, 0.8746358943418656, 0.839801048465997, 0.7283659257208498, 0.8286959313816733, 0.838120361155416, 0.8945472422519964, 0.9134155845303213, 0.9336530178114046, 0.651128759202395, 0.7608536665760012, 0.8948744352775921, 0.6305249656995882, 0.7733931223912216, 0.8276907495082431, 0.8692994565663434, 0.8559146086693218, 0.8807463945030223, 0.9346232809684474, 0.8758653415323971, 0.9036715883938113, 0.8600822847806917, 0.874052602069745, 0.7873470391047601, 0.8317655344122528, 0.8423379039186681, 0.7969931907374606, 0.9124864984581901, 0.944821089890448, 0.8157660978031841, 0.7254739109287384, 0.8537614745499874, 0.8468573760823486, 0.901593254023473, 0.8438780430747661, 0.8948336713194263, 0.8692233938334994, 0.8470062807334009, 0.9213547874740173, 0.8192925755025923, 0.714059447266368, 0.8195175068294972, 0.9273936067277129, 0.7221239681779424, 0.6081396092391143, 0.8817883088183485, 0.7662172451347486, 0.7673043301626181, 0.9348999819649968, 0.8431033303315089, 0.7778924493932898, 0.8424087226528013, 0.8507160213648671, 0.6988117745397987, 0.7950954654182467, 0.8303137985521053, 0.7497076037949276, 0.8319874651023406, 0.8976303616193586, 0.8126936151150892, 0.8928183630039311, 0.8448053436210319, 0.8192638152830521, 0.782579097152199, 0.8289199142115862, 0.8247089161057282, 0.8165195657010353, 0.8873062803571095, 0.903102019396692]
    sccs_perturbed_64 =[0.9871649417754571, 0.933747363501875, 0.930996176441437, 0.9900997592756652, 0.9095829674420951, 0.9670229526497396, 0.9431274225063992, 0.9251374148043277, 0.9555580095791584, 0.966617983414326, 0.9594873378052462, 0.9318491275577583, 0.8723757363278872, 0.9430225789681289, 0.8706708191136684, 0.9315349829389713, 0.9225306679149325, 0.8983851047148813, 0.958756782028515, 0.9742274089500991, 0.9908976563060315, 0.937460231297224, 0.9151275372591493, 0.9571465347760786, 0.8881953242060624, 0.8232268456982079, 0.8200594094570502, 0.9390306825015458, 0.9297563910917424, 0.8152279861141869, 0.9567604915616391, 0.9529375202833417, 0.8499464948614017, 0.9008656379812605, 0.9050443711149155, 0.9182671444819204, 0.9079490072130807, 0.9223345352479072, 0.9495460944032478, 0.9494443286233292, 1.0, 0.9075732767884854, 0.8710771617308734, 0.9367865661353085, 0.8943790269581093, 0.9512605351088668, 0.9279708012439255, 0.9276074187674571, 0.9194651462135629, 0.9232790202217436, 0.9326665377189012, 0.6769122948002765, 0.7492317656951404, 0.8266118347868187, 0.9572834809460263, 0.7704786199479211, 0.8643813748906005, 0.8981339479185587, 0.9076738327617799, 0.9020196327179965, 0.9916106549649446, 0.9613800677639971, 0.9319246945284072, 0.9518218764828569, 0.8549690002963527, 0.8517774184368659, 0.9604030012564294, 0.9090412873137662, 0.8460950299951067, 0.9616704023074554, 0.8829825537988646, 0.8874252032738551, 0.9219548757506473, 0.8665232361153348, 0.8816631000873935, 0.8173610355918192, 0.8129961959057898, 0.9478445356378736, 0.8496381647292917, 0.8610206095901421, 0.9389073399693596]
    all_sccs = [sccs_correct, sccs_perturbed_1, sccs_perturbed_2, sccs_perturbed_4, sccs_perturbed_8, sccs_perturbed_16, sccs_perturbed_32, sccs_perturbed_64, opt]

    plt.plot(sccs_correct, label='MUX')
    plt.plot(sccs_perturbed_1, label='Perturbed, 1')
    plt.plot(sccs_perturbed_2, label='Perturbed, 2')
    plt.plot(sccs_perturbed_4, label='Perturbed, 4')
    plt.plot(sccs_perturbed_8, label='Perturbed, 8')
    plt.plot(sccs_perturbed_16, label='Perturbed, 16')
    plt.plot(sccs_perturbed_32, label='Perturbed, 32')
    plt.plot(sccs_perturbed_64, label='Perturbed, 64')
    plt.plot(opt, label='opt')
    plt.legend()
    plt.show()

    errs_1 = [0.00716706265204875, 0.02348806152868125, 0.003969789091828126, 0.0048956135540975, 0.02517602663138124, 0.006633381916063752, 0.00477930834234, 0.010629741637123758, 0.0016695297118762514, 0.004662341604228749, 0.0036541018732899992, 0.001303317561507501, 0.00798140852176, 0.00388716695512625, 0.00288651934706125, 0.006039693780840002, 0.0, 0.026740596486296245, 0.001416340807688125, 0.0030681377207887493, 0.00608890064339375, 0.024126419658508747, 0.004787211599443749, 0.006043783665493749, 0.006487095046441249, 0.025066935396341253, 0.0033740388691025037, 0.00355539202059375, 0.00733182766785625, 0.002785567791391877, 0.006271246708676249, 0.006079908711750002, 0.0027378215970618757, 0.0068840619179775, 0.005354798457466251, 0.005162284993084999, 0.00523222519132875, 0.006899153428712501, 0.005346390318455001, 0.00503358512778, 0.014125421159427498, 0.00231366218577375, 0.0022072497556225035, 0.005047626773918749, 0.001714123318187501, 0.024265269580469997, 0.00561375614502125, 0.013615072940103126, 0.005879141564203751, 0.003446166152738749, 0.0038034404842962532, 0.0016484032139525006, 0.0023944013966806267, 0.0051008099164099995, 0.0060270144635300015, 0.00234540468838, 0.003787549954186251, 0.0066419697211462505, 0.0, 0.00263449029012375, 0.0022314947593375005, 0.0022334124755318766, 0.0013410912781912513, 0.004470381739245, 0.005799769733670001, 0.008115844760195001, 0.00358545876795875, 0.0028136595502168764, 0.00515045328585875, 0.0, 0.02853266355786502, 0.007180703933571248, 0.027431385005449994, 0.006938178145524999, 0.003717942875209377, 0.0, 0.006331200065755001, 0.0, 0.008288913083933749, 0.0047086607148650005, 0.0032796105690031246]
    errs_2 = [0.013643491623303751, 0.027305806828486875, 0.011897739532852501, 0.010542324387510002, 0.011539215806038752, 0.008478710152945, 0.016058824836248133, 0.020820362299861884, 0.005161628767378756, 0.031461011225882504, 0.004460688209781251, 0.006103124448628127, 0.00977676462511375, 0.011819229533728126, 0.02438818675616, 0.02946074700174373, 0.008166937036695002, 0.02789276972424499, 0.010251202177110001, 0.004336329819290002, 0.008873512118003753, 0.02762368591952626, 0.008331628786782501, 0.006608145134975002, 0.006337782196879375, 0.005922285157549381, 0.010236617564530627, 0.030555461105875016, 0.012015899099451253, 0.009328141637475, 0.010237989065348126, 0.013309112948581255, 0.03148792260374624, 0.00867972057401375, 0.015035314029570004, 0.007441970013966876, 0.01531410684846188, 0.007234093736520001, 0.009112657482382502, 0.009066231568643753, 0.02513417521964251, 0.0066804902304925, 0.009513077267413749, 0.006728753988128749, 0.030571437772610004, 0.007327754143896255, 0.006215913766096249, 0.007590761001747499, 0.0103355770304275, 0.014554363517364999, 0.013899353480107504, 0.0070553078725674985, 0.011650304546185, 0.008005782934670002, 0.027061774513278753, 0.007650827730367498, 0.008533571098919376, 0.010661395655116252, 0.005213640434484999, 0.006367621430738747, 0.007069318647940003, 0.0035262243554662538, 0.01719975166342938, 0.0036258392942500007, 0.01374378321865813, 0.008042595574966878, 0.009236524164310624, 0.005306181320363751, 0.009903608545065, 0.003586488761872501, 0.003717988828126253, 0.0039049527291843775, 0.0018679734979000018, 0.004193071311597502, 0.004585304798995001, 0.005080322878595001, 0.004745627443434377, 0.0022194305537325005, 0.010986039546402503, 0.01032813664109625, 0.010230569955579383]
    errs_4 = [0.03521919432856876, 0.006258203965106876, 0.05907314967127433, 0.07050743540956876, 0.011479237544006251, 0.019178918193097517, 0.01803687058626625, 0.0146970370096925, 0.011601136934246248, 0.022391831355128754, 0.039512899280091246, 0.016123621959581245, 0.011380782648352501, 0.022624759326936247, 0.016075917713346873, 0.01970873999376312, 0.017633125311529375, 0.019671302157992506, 0.0212421599414875, 0.041375913874866874, 0.011656643968562499, 0.03505000239986187, 0.027094873011098128, 0.0551831106148275, 0.014586079154556253, 0.009856756195659377, 0.018055453916919376, 0.04411174125773, 0.036878784689424376, 0.020131525783952497, 0.020675882215011248, 0.020384860928741876, 0.0189284908764275, 0.013159108615264375, 0.017043367799787504, 0.024922200891710627, 0.011757326408248128, 0.0177654289013875, 0.016116494520204375, 0.03470011056950375, 0.0158064629390225, 0.054593667934833744, 0.021363544494654375, 0.023616056608175624, 0.012662583033776875, 0.03584258342931374, 0.014153626490156253, 0.011267548054139374, 0.01965936456648313, 0.009947811566791252, 0.013584788619965005, 0.044152230876057505, 0.010987573273588751, 0.01450657937298438, 0.019214293741443747, 0.033300517128215606, 0.012148860777457506, 0.04778054022864623, 0.011188779536304374, 
0.03257758685167376, 0.012772383623928128, 0.014161616684616258, 0.011983031817040002, 0.0087177113032475, 0.014041395882282504, 0.006981475450591879, 0.02516414310999001, 0.01882577935572438, 0.004602527921630001, 0.010299932010745003, 0.0165481295394525, 0.04131170436561626, 0.03588424055064812, 0.014390675399830001, 0.01521532695272188, 0.035151045831625635, 0.0192023042561875, 0.015295852301943129, 0.015201763687503748, 0.03582323373575937, 0.012522587485660002]
    errs_8 = [0.04069144694005937, 0.04270380693441375, 0.05138364674571436, 0.03181490491664563, 0.08614721673615311, 0.06535854037145876, 0.05833604208685125, 0.028695710330757507, 0.049046294780730616, 0.03305895821170937, 0.050650698399923116, 0.08683724248446001, 0.03938484288447125, 0.02018517353261938, 0.029799481590209377, 0.0493463908815969, 0.052729837405815, 0.049683315460465, 0.04455311443203312, 0.031832678843638745, 0.057845423381481256, 0.05033228780472813, 0.07375177627921187, 0.04586938493856562, 0.023017739467365617, 0.052748022915300015, 0.03780770811004374, 0.0218343577774275, 0.06121030772451437, 0.03545952550656312, 0.07322347976839999, 0.07307960873400249, 0.02206831596177875, 0.03294627518473126, 0.037584965523093115, 0.02930900769809938, 0.08066325754267314, 0.02790173676236001, 0.06680954942604936, 0.05587466386681064, 0.10977691105681629, 0.0476574138486275, 0.05212628098177124, 0.0375435184677625, 0.03861515875246001, 0.07709099487320312, 0.07901619908432501, 0.021009145480761875, 0.03350112708142249, 0.049898564115944996, 0.05739482476366312, 0.0374974689132475, 0.04928088059194938, 0.03448173196051625, 0.0626007174833256, 0.03333899539657998, 0.04997903353161062, 0.03153030687731625, 0.03530086532907812, 0.025951730018420004, 0.06134085153923248, 0.05101943953614373, 0.07768647408609873, 0.05996931563221688, 0.04227057390179063, 0.028104209575618763, 0.058220178239264356, 0.03422731592716126, 0.03221036250683, 0.060054564029464984, 0.036451760836978125, 0.06028682745631561, 0.05845050600381749, 0.052856758292809364, 0.040436691072720625, 0.047994026834612506, 0.036789670763408125, 0.0295705642891525, 0.035985514694019984, 0.03179807270052, 0.07541877121266252]
    errs_16 = [0.06734849248415313, 0.11944158322892877, 0.11090467728675125, 0.10742646796460625, 0.10198188401541937, 0.11405423039217498, 0.09720340867682317, 0.1472642459080775, 0.07859369383075626, 0.07679940640143249, 0.058790995259808715, 0.08789638659089626, 0.060893195879315645, 0.06429098114863187, 0.09628489940425128, 0.1330415711423113, 0.10485653809487064, 0.08165240911532128, 0.08331636374756876, 0.1359438364294863, 0.10945325820606687, 0.1252044685837231, 0.06558876323122438, 0.09940298569278937, 0.08380912946165435, 0.09985162645005502, 0.084736730362715, 0.09474124566849379, 0.12633041639679188, 0.143004793094755, 0.09257306063466185, 0.0874107376164325, 0.07103561911521876, 0.10808122896369748, 0.10253561627930187, 0.09580391356973184, 0.12952018051269382, 0.13116157432165315, 0.08932164661259687, 0.07851593080206001, 0.29796004377151375, 0.09877088174382437, 0.11005317752235058, 0.058888270946264996, 0.07452632814450685, 0.08707381462069877, 0.11004042795179249, 0.07380196821958565, 0.054553715621141884, 0.06433070570858061, 0.10209397247679627, 0.06342833172246189, 0.12769933647646622, 0.05415848803834561, 0.12626324192291125, 0.08339156238181125, 0.11417631760610748, 0.1255302631563437, 0.09866067171837686, 0.08187615141199689, 0.050622859967782485, 0.1177531203256025, 0.062113471333219365, 0.09604275650449373, 0.08577875213503625, 0.08942447340378752, 0.06343823959912999, 0.12333285714716254, 0.1142932765359225, 0.10588178986969435, 0.04721987269665687, 0.10205865014176625, 0.18111106014186068, 0.06244362774673313, 0.12304040814497254, 0.10831155865770686, 0.06352474749764063, 0.12181050951090874, 0.06402950012078064, 0.09109826431300877, 0.08376763576613498]
    errs_32 = [0.20619279361204498, 0.2821625739263244, 0.231285124191895, 0.23388674270027068, 0.16471691182771062, 0.16054662810982495, 0.2099736648911263, 0.1635601891971169, 0.18268529187869867, 0.24714861833875873, 0.1864086699691594, 0.19560258707451061, 0.16530278694669373, 0.19178013976022562, 0.21877871754932063, 0.2569175455788757, 0.2294671898857294, 0.16000475539039563, 0.2279743399356643, 0.18716073580681938, 0.24040010643502246, 0.18750614048663877, 0.15612947938704302, 0.23389836968938874, 0.1873267986777187, 0.20413821808664867, 0.1825875530853125, 0.25201293228960997, 0.24233908952049632, 0.1744273183756006, 0.22849790403775747, 0.24160055161958943, 0.24349794328673183, 0.19898684009046683, 0.1369335791787356, 
0.23462490980160627, 0.16751599727254057, 0.1485367164218637, 0.1718580303698863, 0.17547135163617625, 0.49076426171345006, 0.18800483509566185, 0.18379778285312065, 0.17718407987871568, 0.11254133797990817, 0.1446297691538631, 0.19949106754118823, 0.21093332707917184, 0.1883915109181175, 0.21972296720586754, 0.13726631003778245, 0.20722123409850549, 0.17459238280911432, 0.1505455644926688, 0.20981291757619558, 0.16528494883205938, 0.21854820825016497, 0.21759947942979754, 0.18914417551845628, 0.19493749209992445, 0.17835263758335562, 0.15184817866992625, 0.19084039559597002, 0.1452000583786831, 0.17813111825068875, 0.18063215745551062, 0.2500239257704506, 0.21974342544518255, 0.16712176513983873, 0.13652053838805062, 0.13936169660564063, 0.15943364722066064, 0.1732628201032737, 0.16296215405885128, 0.1625630166349925, 0.1348549519379144, 0.14809589570767062, 0.15586229479581873, 0.21051062958375388, 0.1522304477733994, 0.09381795861973936]
    errs_64 = [0.4156170072407825, 0.4315860148891764, 0.4358492678269781, 0.4392149127766982, 0.39894504844167067, 0.34787852670169067, 0.3661086310322812, 0.34835961034789986, 0.34455048577751946, 0.43103365231473206, 0.43619584414915935, 0.37065546262110693, 0.4876413692161102, 0.3826200559747056, 0.3983165542395337, 0.39149958988756245, 0.33047925662732247, 0.31388881487030934, 0.36069045059611377, 0.46459774384540936, 0.36314957437128564, 0.36176170387803674, 0.3258571081911325, 0.3185999576081881, 0.3658641557979556, 0.3269555127763031, 0.3607480304772974, 0.46183065328037076, 0.4796123996132174, 0.3583339603416137, 0.43046491617143817, 0.3911943965361712, 0.35395218126135375, 0.43170340372974303, 0.3960303199348337, 0.3565198444525094, 0.4241420373336712, 0.43874691655903375, 0.36861629681483843, 0.37016678082052124, 0.7599512562182411, 0.37934525455457646, 0.3902928748784876, 0.3767453363702401, 0.33848416303675505, 0.3818950781791286, 0.4029439433499945, 
0.33282969266309254, 0.4176338329328144, 0.32091697221588505, 0.2861523149093212, 0.36955550302544377, 0.29821098956813935, 0.3741370357623788, 0.3807082076444275, 0.3395720142878475, 0.3480505936275742, 0.42405034774480066, 0.35668055225537565, 0.4030482647844169, 0.3586465418909304, 0.3573489179435087, 0.34004032521127625, 0.4144447765155243, 0.36000479369748817, 0.3379102522311582, 0.38247412646185003, 0.31634586731972064, 0.3482733398145194, 0.32963699871606317, 0.36937306987601687, 0.3102623633952675, 0.39536715009830314, 0.41368347985217624, 0.3819908853862319, 0.37446210525197243, 0.2908048038227713, 0.3786430253508136, 0.34370412222630514, 0.26389010595037876, 0.27389041469198194]
    all_errs = [errs_1, errs_2, errs_4, errs_8, errs_16, errs_32, errs_64]

    plt.plot(errs_1, label='errs, 1')
    plt.plot(errs_2, label='errs, 2')
    plt.plot(errs_4, label='errs, 4')
    plt.plot(errs_8, label='errs, 8')
    plt.plot(errs_16, label='errs, 16')
    plt.plot(errs_32, label='errs, 32')
    plt.plot(errs_64, label='errs, 64')
    plt.legend()
    plt.show()

    names = ['mux', '1', '2', '4', '8', '16', '32', '64', 'opt']
    means = [np.mean(scc) for scc in all_sccs]
    stds = [np.std(scc) for scc in all_sccs]
    for (name, mean, std) in zip(names, means, stds):
        plt.bar(name, mean, width=0.4, yerr = std)
    plt.xlabel("Circuit type or # of perturbations")
    plt.ylabel("Average SCC")
    plt.show()

    names = ['1', '2', '4', '8', '16', '32', '64']
    means = [np.mean(err) for err in all_errs]
    stds = [np.std(err) for err in all_errs]
    for (name, mean, std) in zip(names, means, stds):
        plt.bar(name, mean, width=0.4, yerr = std)
    plt.xlabel("# of perturbations")
    plt.ylabel("Average Err")
    plt.show()